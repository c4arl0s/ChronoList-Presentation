# ChronoList-Presentation

This README file only pretends to be a presentation for the real project.

# [go back to Overview](https://github.com/c4arl0s)

# [ChronoList - Content](https://github.com/c4arl0s/ChronoList#go-back-to-overview)

1. [First ideas](https://github.com/c4arl0s/ChronoList#1-first-ideas)
2. [Modify the cell to add a Start/Done button](https://github.com/c4arl0s/ChronoList#2-modify-the-cell-to-add-a-startdone-button)
3. [Modify ToDo Model](https://github.com/c4arl0s/ChronoList#3-modify-todo-model)
4. [Replace MyToDoTableViewController with ToDoViewController](https://github.com/c4arl0s/ChronoList#4-replace-mytodotableviewcontroller-with-todoviewcontroller)
5. [Fix Checkmark button image when is selected](https://github.com/c4arl0s/ChronoList#5-fix-checkmark-button-image-when-is-selected)
6. [Fix Show Add New ToDo Segue](https://github.com/c4arl0s/ChronoList#6-fix-show-add-new-todo-segue)
7. [Fix Show Details To Do Segue](https://github.com/c4arl0s/ChronoList#7-fix-show-details-to-do-segue)
8. [Fix Issue when you tap save button to a new ToDo object](https://github.com/c4arl0s/ChronoList#8-fix-issue-when-you-tap-save-button-to-a-new-todo-object)
9. [Fix selected Cell](https://github.com/c4arl0s/ChronoList#9-fix-selected-cell)
10. [Modify Due Date Cell Constraints](https://github.com/c4arl0s/ChronoList#10-modify-due-date-cell-constraints)
11. [Fix Edit button](https://github.com/c4arl0s/ChronoList#11-fix-edit-button)
12. [Fix Save button after select any table view cell to show details](https://github.com/c4arl0s/ChronoList#12-fix-save-button-after-select-any-table-view-cell-to-show-details)
13. [Use PropertyKey struct](https://github.com/c4arl0s/ChronoList#13-use-propertykey-struct)
14. [Fix Date Picker Cell](https://github.com/c4arl0s/ChronoList#14-fix-date-picker-cell)
15. [Fix dismiss keyboard when you tap Return button keyboard](https://github.com/c4arl0s/ChronoList#15-fix-dismiss-keyboard-when-you-tap-return-button-keyboard)
16. [Create Layout for CalendarView and ToDoTableView](https://github.com/c4arl0s/ChronoList#16-create-layout-for-calendarview-and-todotableview)
17. [Create CalendarView.xib and layout](https://github.com/c4arl0s/ChronoList#17-create-calendarviewxib-and-layout)
18. [Create load calendar view](https://github.com/c4arl0s/ChronoList#18-create-load-calendar-view)
19. [Add ProjectName property to ToDo class and NewProjectNameViewController](https://github.com/c4arl0s/ChronoList#19-add-projectname-property-to-todo-class-and-newprojectnameviewcontroller)
20. [Replace to Plus sign in CalendarView](https://github.com/c4arl0s/ChronoList#20-replace-to-plus-sign-in-calendarview)
21. [Modify the number of Tasks](https://github.com/c4arl0s/ChronoList#21-modify-the-number-of-tasks)
22. [Modify Add button according to design](https://github.com/c4arl0s/ChronoList#22-modify-add-button-according-to-design)
23. [Add SegmentedControl according to new Design](https://github.com/c4arl0s/ChronoList#23-add-segmentedcontrol-according-to-new-design)
24. [Add a row in CalendarView to show the day number](https://github.com/c4arl0s/ChronoList#24-add-a-row-in-calendarview-to-show-the-day-number)
25. [Move hour Labels to the right](https://github.com/c4arl0s/ChronoList#25-move-hour-labels-to-the-right)
26. [Create a dayFilterSegmentedControl UISegmentedControl](https://github.com/c4arl0s/ChronoList#26-create-a-dayfiltersegmentedcontrol-uisegmentedcontrol)
27. [Create filter function for Today, Yesterday and Tomorrow](https://github.com/c4arl0s/ChronoList#27-create-filter-function-for-today-yesterday-and-tomorrow)
28. [When you tap any cell, you have to inject the correct ToDo object, according to suitable array](https://github.com/c4arl0s/ChronoList#28-when-you-tap-any-cell-you-have-to-inject-the-correct-todo-object-according-to-suitable-array)
29. [When you create a new ToDo, save it correctly and show it in table view](https://github.com/c4arl0s/ChronoList#29-when-you-create-a-new-todo-save-it-correctly-and-show-it-in-table-view)
30. [Change Project's name](https://github.com/c4arl0s/ChronoList#30-change-projects-name)
31. [Write ToDoController, basic functionality.](https://github.com/c4arl0s/ChronoList#31-write-todocontroller-basic-functionality)
32. [Fix the AddButton.swift file again](https://github.com/c4arl0s/ChronoList#32-fix-the-addbuttonswift-file-again)
33. [git reset --hard ba0e0b2](https://github.com/c4arl0s/ChronoList#33-git-reset---hard-ba0e0b2)
34. [Rename project to ChronoList again](https://github.com/c4arl0s/ChronoList#34-rename-project-to-chronolist-again)
35. [Rename Targets to ChronoList, ChronoListTests, and ChronoListUITests](https://github.com/c4arl0s/ChronoList#35-rename-targets-to-chronolist-chronolisttests-and-chronolistuitests)
36. [Write ToDoController in a new brach, basic functionality, again](https://github.com/c4arl0s/ChronoList#36-write-todocontroller-in-a-new-brach-basic-functionality-again)
37. [Use ToDoController to save and load ToDo objects](https://github.com/c4arl0s/ChronoList#37-use-todocontroller-to-save-and-load-todo-objects)
38. [Create function to filter yesterday ToDos in ToDoController](https://github.com/c4arl0s/ChronoList#38-create-function-to-filter-yesterday-todos-in-todocontroller)
39. [When you tap Yesterday Segmented COntrol button, update table to show  yesterday ToDo](https://github.com/c4arl0s/ChronoList#39-when-you-tap-yesterday-segmented-control-button-update-table-to-show-yesterday-todo)
40. [Fix when you add and edit a ToDo object](https://github.com/c4arl0s/ChronoList#40-fix-when-you-add-and-edit-a-todo-object)
41. [Improve `unwindToToDoList(sender:)` after you save a new ToDo object](https://github.com/c4arl0s/ChronoList#41-improve-unwindtotodolistsender-after-you-save-a-new-todo-object)
42. [Move check box button to the right](https://github.com/c4arl0s/ChronoList#42-move-check-box-button-to-the-right)
43. [Once you tap addButton show keyboard right away](https://github.com/c4arl0s/ChronoList#43-once-you-tap-addbutton-show-keyboard-right-away)
44. [Move Segmented Control outside of toolbar](https://github.com/c4arl0s/ChronoList#44-move-segmented-control-outside-of-toolbar) 
45. [In New To Do Viewcontroller, move check box to the right.](https://github.com/c4arl0s/ChronoList#45-in-new-to-do-viewcontroller-move-check-box-to-the-right)

# ChronoList

Simple To Do list app with time tracker

# 1. [First ideas](https://github.com/c4arl0s/ChronoList#chronolist---content)

![IMG_1399](https://user-images.githubusercontent.com/24994818/95687069-f8c4a880-0bc6-11eb-82d1-383da5b291ca.jpg)

# 2. [Modify the cell to add a Start/Done button](https://github.com/c4arl0s/ChronoList#chronolist---content)

1. Clear constraints of the text field.
2. Resize the text field to add Start/done button.
3. Set constraints to Start/Done button.
- Alignment: vertically in container.
- Width: greater or equal to 46. 

![Screen Shot 2020-10-10 at 13 18 43](https://user-images.githubusercontent.com/24994818/95662246-280de380-0afb-11eb-958c-64a72ecfe54e.png)

4. Set constraints to text field:
- Alignment: vertically in container.
- Horizontal space constraint: Constant 8 (from the textField to checkMarkButton, and from the text field to the StartButton.

![Screen Shot 2020-10-10 at 13 19 33](https://user-images.githubusercontent.com/24994818/95662266-41af2b00-0afb-11eb-8a2f-6f177e70dc7f.png)

5. Build and run.

![Screen Shot 2020-10-10 at 13 32 51](https://user-images.githubusercontent.com/24994818/95662509-1dece480-0afd-11eb-863b-941ebe3dfa9c.png)

# 3. [Modify ToDo Model](https://github.com/c4arl0s/ChronoList#chronolist---content)

Current:

```swift
var title: String
var isComplete: Bool
var dueDate: Date
var note: String?
```

Which are the requirements ?

1. you have to store the due date, which you already have
2. I want to store the hour I stared the ToDo. We can name it: startDate
3. I want to store the hour I finish the ToDo. We can name it: finishDate.
4. If startDate and finishDate are not in the same dueDate, you can't do the ToDo activity. You will not able to do it, You have to re schedule. This activity have to be registered as a non acomplished activity. It would be bad for you if this happens. What you plan, you have to do it.

I think if we add this properties I can calculate the performance of a week

```swift
var title: String
var isComplete: Bool
var dueDate: Date
var startDate: Date
var finishDate: Date
var note: String?
```

![Screen Shot 2020-10-11 at 13 04 21](https://user-images.githubusercontent.com/24994818/95686267-573b5800-0bc2-11eb-9568-5d3226f44b7a.png)

As when you create a new ToDo Activity you don't need to fill the startDate and finishDate, you can declare both properties as optionals. If you declared as stored properties, it throws a compile error. So,

```swift
var title: String
var isComplete: Bool
var dueDate: Date
var startDate: Date?
var finishDate: Date?
var note: String?
```

Build and run, it is ok!

# 4. [Replace MyToDoTableViewController with ToDoViewController](https://github.com/c4arl0s/ChronoList#chronolist---content)

1. Delete MyTodoTableViewController.
2. Conect ToDoViewController with ToDoVieController swift file. (all Outlets and subclass)
3. Drag and drop a new TableViewCell into the TableView.
4. Connect cell with custom cell: ToDoTableViewCell
5. Register the xib file for the cell and create the cell in appropiate Table View Data source method. Create the segues to trigger the NewToDoTableViewController.

# 5. [Fix Checkmark button image when is selected](https://github.com/c4arl0s/ChronoList#chronolist---content)

Remember to configure Button State: **Default**

![Screen Shot 2020-10-15 at 13 56 49](https://user-images.githubusercontent.com/24994818/96174057-5f5f0480-0eee-11eb-8d88-192c68115b38.png)

Configure button state: **Selected**

![Screen Shot 2020-10-15 at 13 55 51](https://user-images.githubusercontent.com/24994818/96174062-6128c800-0eee-11eb-9eb0-eef718c32d43.png)

# 6. [Fix Show Add New ToDo Segue](https://github.com/c4arl0s/ChronoList#chronolist---content)

1. I have to delete the navigation controller.
2. Embed NewToDoViewController into new navigation controller.
3. Drag and drop from + button to navigation controller.
4. Set identifier to: ShowAddNewToDo.

![Screen Shot 2020-10-18 at 1 42 53](https://user-images.githubusercontent.com/24994818/96360486-45d2de00-10e3-11eb-9e5b-1395f265ed19.png)

5. Finally, keep the same piece of code in `prepare(forSegue:sender:)` method:

```swift
override func prepare(for segue: UIStoryboardSegue, sender: Any?) {
    if segue.identifier == "showDetails" {
        let toDoViewController = segue.destination as! NewToDoViewController
        let indexPath = tableView.indexPathForSelectedRow!
        let selectedTodo = toDos[indexPath.row]
        toDoViewController.toDo = selectedTodo
    }
}
```

Build and run.

![Screen Recording 2020-10-18 at 1 46 27 2020-10-18 01_48_57](https://user-images.githubusercontent.com/24994818/96360589-1f617280-10e4-11eb-94e8-0b1483377b1f.gif)

# 7. [Fix Show Details To Do Segue](https://github.com/c4arl0s/ChronoList#chronolist---content)

1. Drag and drop from the table view cell to the **NewToDoViewController** directly. (no passing through navigation controller) Like in the image, select **Show**. 

![Screen Shot 2020-10-18 at 2 57 20](https://user-images.githubusercontent.com/24994818/96361720-ac5cf980-10ed-11eb-8802-01969e47b1ab.png)


2. When you did select the cell, perform the segue:

```swift
func tableView(_ tableView: UITableView, didSelectRowAt indexPath: IndexPath) {
    performSegue(withIdentifier: "ShowDetailsToDo", sender: self)
}
```

3. [Uncheck Enabled Control mark in Title text Field, inside ToDoTableViewCell.xib:](https://github.com/c4arl0s/ChronoList#chronolist---content)

![Screen Shot 2020-10-18 at 2 43 51](https://user-images.githubusercontent.com/24994818/96361492-c990c880-10eb-11eb-81db-dc2b813c8e14.png)

So, now when you tap, the segue is trigger easily.

# 8. [Fix Issue when you tap save button to a new ToDo object](https://github.com/c4arl0s/ChronoList#chronolist---content)

The segue identifier was missing. So you have to set again: **SaveUnwind** 

![Screen Shot 2020-10-19 at 9 40 01](https://user-images.githubusercontent.com/24994818/96465896-1d380a80-11ef-11eb-8fad-9526b2a819fd.png)

Then you can save the ToDo object again.

# 9. [Fix selected Cell](https://github.com/c4arl0s/ChronoList#chronolist---content)

When you select a cell you show the **AddNewTodoViewController**, when it dismissed, the cell has to be deselected.

![Screen Recording 2020-10-20 at 11 36 16 2020-10-20 11_37_17](https://user-images.githubusercontent.com/24994818/96616965-a0795f00-12c8-11eb-99e9-ce03c90f4bac.gif)

The solution is to call the instance method `deselectedRow(at:,animated:)` of the tableView:

```swift
tableView.deselectRow(at: selectedIndexPath, animated: true)
```

You have to call it in the `prepare(for segue:,sender:)` method:

```swift
override func prepare(for segue: UIStoryboardSegue, sender: Any?) {
    if segue.identifier == "ShowDetailsToDo" {
        let toDoViewController = segue.destination as! NewToDoViewController
        let selectedIndexPath = tableView.indexPathForSelectedRow!
        tableView.deselectRow(at: selectedIndexPath, animated: true)
        let selectedToDo = toDos[selectedIndexPath.row]
        toDoViewController.toDo = selectedToDo
    }
}
```

> I tried to do it in `didSelecteIndext(at indexPath:)` but this method clears the **indexPathForSelectedRow** property, and this property is required in `prepare(for segue:,sender)` method, so, the application crashes when it tries to access the property.

Build and run. Now the cell is deselected after you tap any cell.

![Screen Recording 2020-10-20 at 11 50 09 2020-10-20 11_51_35](https://user-images.githubusercontent.com/24994818/96922732-d576e480-1475-11eb-9346-b172f1f2089b.gif)

# 10. [Modify Due Date Cell Constraints](https://github.com/c4arl0s/ChronoList#chronolist---content)

The actual Due Date Cell has a stack view in its container. Suppress this horizontal stack view, because I think it is too complex to use when the cell only has to subviews (2 labels). 

Before:

![Screen Shot 2020-10-22 at 15 23 13](https://user-images.githubusercontent.com/24994818/96925914-84b5ba80-147a-11eb-9703-b5e21dd8cb70.png)

After:

![Screen Shot 2020-10-22 at 15 22 04](https://user-images.githubusercontent.com/24994818/96925827-5afc9380-147a-11eb-8849-b22ba6008f46.png)


# 11. [Fix Edit button](https://github.com/c4arl0s/ChronoList#chronolist---content)

- **Given It displays to do table view controller 
- **When I tap Edit button
- **Then Display Delete button correctly, and set editing mode

- **Given It displays to do table view controller.
- **When I tap Done button
- **Then Display Edit button correctly, and unset editing mode.

1. Drag and drop **UIBarButtonItem** object, name it **editBarItemButton** set System Item to Custom.
2. Create an IBOutlet for **editBarItemButton** 

```swift
@IBOutlet weak var editBarButtonItem: UIBarButtonItem!
```

3. Set bar button item title to "Edit" in `viewDidLoad()` because as it is a custom item, it needs suitable title

```swift
editBarButtonItem.title = "Edit"
```

4. Create an IBAction for **editBarButtonItemTapped** and do the logic:

```swift
@IBAction func editBarButtonItemTapped(_ sender: UIBarButtonItem) {
    if !tableView.isEditing {
        tableView.setEditing(true, animated: true)
        sender.title = "Done"
    } else {
        tableView.setEditing(false, animated: true)
        sender.title = "Edit"
    }
}
```

5. Do not forget connect the action.
6. Build and run.

![Screen Recording 2020-10-26 at 22 17 27 2020-10-26 22_19_21](https://user-images.githubusercontent.com/24994818/97256703-6385fe80-17d9-11eb-9fe8-58ae684224cd.gif)

# 12. [Fix Save button after select any table view cell to show details](https://github.com/c4arl0s/ChronoList#chronolist---content)

- **Given I am displaying Details of a note.
- **When I tap Save button
- **Then save actual toDo object and do not duplicate.

1. Reviewing the piece of code that saves the **toDo** instance, I did find that I was clearing the property **indexPathForSelectedRow** when I was preparing the segue, so the flow of the program was not updating the **toDo** instance. This did duplicate the **toDo** instance. To fix this, first remove the line where you were clearing the property, this was located in `prepare(forSegue:)`  method.
2. Modify `unwindToToDoList(segue:)` method, replace the logic with a switch case statement.

```swift
@IBAction func unwindToToDoList(segue: UIStoryboardSegue) {
    switch segue.identifier {
    case "SaveUnwind":
        let sourceViewController = segue.source as! NewToDoViewController
        if let toDo = sourceViewController.toDo {
            if let selectedIndexPath = tableView.indexPathForSelectedRow {
                toDos[selectedIndexPath.row] = toDo
                tableView.reloadRows(at: [selectedIndexPath], with: .none)
                tableView.deselectRow(at: selectedIndexPath, animated: true)
            } else {
                let newIndexPath = IndexPath(row: toDos.count, section: 0)
                toDos.append(toDo)
                tableView.insertRows(at: [newIndexPath], with: .automatic)
            }
            ToDo.saveToDos(toDos)
        }
    case "CancelUnwind":
        if let selectedIndexPath = tableView.indexPathForSelectedRow {
        tableView.deselectRow(at: selectedIndexPath, animated: true)
        }
    default:
        preconditionFailure("No segue identified")
    }
}
```

3. Verify the **CancelUnwind** identifier correspond to the segue from Cancel Button to Exit object.

![Screen Shot 2020-10-27 at 1 21 41](https://user-images.githubusercontent.com/24994818/97269227-cc2da500-17f2-11eb-8495-b8895e7e3b1b.png)

4. Build and run.

![Screen Recording 2020-10-27 at 1 30 03 2020-10-27 01_32_55](https://user-images.githubusercontent.com/24994818/97270180-5c201e80-17f4-11eb-8d50-05096a1c8b22.gif)

# 13. [Use PropertyKey struct](https://github.com/c4arl0s/ChronoList#chronolist---content)

1. Use it in NewToDoTableViewController

```swift
struct PropertyKeys {
    static let SaveUnwind = "SaveUnwind"
}
```
2. Use it in ToDoTableViewController

```swift
struct PropertyKeys {
    static let ToDoCellIdentifier = "ToDoCellIdentifier"
    static let ShowDetailsToDo = "ShowDetailsToDo"
    static let SaveUnwind = "SaveUnwind"
    static let CancelUnwind = "CancelUnwind"
}
```

# 14. [Fix Date Picker Cell](https://github.com/c4arl0s/ChronoList#chronolist---content)

![Screen Shot 2020-10-27 at 13 28 05](https://user-images.githubusercontent.com/24994818/97352242-493f3580-1858-11eb-8248-29fa080bc424.png)

![Screen Shot 2020-10-27 at 13 29 15](https://user-images.githubusercontent.com/24994818/97352644-89061d00-1858-11eb-88c8-89fcba1121b6.png)

Build and run again.

![Screen Shot 2020-10-27 at 13 30 50](https://user-images.githubusercontent.com/24994818/97352732-a509be80-1858-11eb-80e3-ec4cb9c94105.png)

# 15. [Fix dismiss keyboard when you tap Return button keyboard](https://github.com/c4arl0s/ChronoList#chronolist---content)

1. Make Conform ToDoViewController to UITextFieldDelegate protocol

```swift
class NewToDoViewController: UITableViewController, UITextFieldDelegate {
```

2. Implement `textFieldShouldReturn(textField:)` delegate method, and make textField to resign first responder:


```swift
func textFieldShouldReturn(_ textField: UITextField) -> Bool {
    textField.resignFirstResponder()
}
```

3. Build and run. Test.

![Screen Recording 2020-10-29 at 22 36 57 2020-10-29 22_42_37](https://user-images.githubusercontent.com/24994818/97660754-1d7aa600-1a38-11eb-92a9-0bd0e2900065.gif)

# 16. [Create Layout for CalendarView and ToDoTableView](https://github.com/c4arl0s/ChronoList#chronolist---content)

1. Clear tableView constraints.
2. Embed tableView into vertical stack view.
3. Drag and drop an UIView object.
4. Set Distribution to Fill Equally,
5. Set vertical stack view constraints to trail = 0, leading = 0, top = 0 and bottom to 0.
6. In toolbar object, delete the space, the add button will be placed at the left corner.
7. Build and run.

![Screen Shot 2020-10-30 at 0 55 07](https://user-images.githubusercontent.com/24994818/97669846-9be04380-1a4a-11eb-9a4f-3940951cd456.png)

# 17. [Create CalendarView.xib and layout](https://github.com/c4arl0s/ChronoList#chronolist---content)

Fist attempt

![Screen Shot 2020-10-30 at 2 14 59](https://user-images.githubusercontent.com/24994818/97676114-bcfa6180-1a55-11eb-8892-d16a393a44c1.png)

# 18. [Create load calendar view](https://github.com/c4arl0s/ChronoList#chronolist---content)

1. Make CalendarView File's owner ToDoViewController

![Screen Shot 2020-10-30 at 18 06 12](https://user-images.githubusercontent.com/24994818/97766101-9df1e300-1ada-11eb-8ec7-1e4050e72647.png)

2. Create an IBOutlet in ToDoViewController.swift

```swift
@IBOutlet weak var calendarView: UIView!
```

3. Make sure to connect the outlet inside CalendarView.xib as in the figure:

![Screen Shot 2020-10-30 at 18 18 34](https://user-images.githubusercontent.com/24994818/97766591-9f240f80-1adc-11eb-943e-72841365a070.png)

4. Load calendar view in `viewDidLoad()` method:

```swift
loadCalendarView()
```

Then:

```swift
Bundle.main.loadNibNamed("CalendarView", owner: self, options: nil)
calendarView.frame.origin = CGPoint(x: 0, y: 55)
view.addSubview(calendarView)
```

Build and run.

![Screen Shot 2020-10-30 at 19 05 09](https://user-images.githubusercontent.com/24994818/97767796-245ef280-1ae4-11eb-8b0d-6c06dfe78a4b.png)

# 19. [Add ProjectName property to ToDo class and NewProjectNameViewController](https://github.com/c4arl0s/ChronoList#chronolist---content)

```swift
import Foundation

struct ToDo: Codable {
    var projectName: String
    var title: String
    var isComplete: Bool
    var dueDate: Date
    var startDate: Date?
    var finishDate: Date?
    var note: String?
    static let DocumentsDirectory = FileManager.default.urls(for: .documentDirectory, in: .userDomainMask).first!
    static let ArchiveURL = DocumentsDirectory.appendingPathComponent("todos").appendingPathExtension("plist")
    
    init(projectName: String, title: String, isComplete: Bool, dueDate: Date, note: String?)
    {
        self.projectName = projectName
        self.title = title
        self.isComplete = isComplete
        self.dueDate = dueDate
        self.note = note
    }
    
    static func loadToDos() -> [ToDo]? {
        guard let codedToDos = try? Data(contentsOf: ArchiveURL) else {return nil}
        let propertyListDecoder = PropertyListDecoder()
        return try? propertyListDecoder.decode(Array<ToDo>.self, from: codedToDos)
    }
    
    static func saveToDos(_ toDos:[ToDo]) {
        let propertyListEncoder = PropertyListEncoder()
        let codedToDos = try? propertyListEncoder.encode(toDos)
        try? codedToDos?.write(to: ArchiveURL, options: .noFileProtection)
    }
    
    static func loadSampleToDos() -> [ToDo] {
        let todo1 = ToDo(projectName: "p1", title: "ToDo 1", isComplete: false, dueDate: Date(), note: "Sample Note 1")
        let todo2 = ToDo(projectName: "p1", title: "ToDo 2", isComplete: false, dueDate: Date(), note: "Sample Note 2")
        let todo3 = ToDo(projectName: "p1", title: "ToDo 3", isComplete: false, dueDate: Date(), note: "Sample Note 3")
        let todo4 = ToDo(projectName: "p1", title: "ToDo 4", isComplete: false, dueDate: Date(), note: "Sample Note 4")
        let todo5 = ToDo(projectName: "p1", title: "ToDo 5", isComplete: false, dueDate: Date(), note: "Sample Note 5")
        return [todo1, todo2, todo3, todo4, todo5]
    }
    
    static let dueDateFormatter: DateFormatter = {
        let formatter = DateFormatter()
        formatter.dateStyle = .short
        formatter.timeStyle = .short
        return formatter
    }()
}
```

Modify temporary `prepareForSegue` method in NewToDoTableViewController:

```swift
override func prepare(for segue: UIStoryboardSegue, sender: Any?) {
    super.prepare(for: segue, sender: sender)
    guard segue.identifier == PropertyKeys.SaveUnwind else { return }
    let title = titleTextField.text!
    let isComplete = isCompletButton.isSelected
    let dueDate = dueDatePickerView.date
    let note = notesTextView.text
    toDo = ToDo(projectName: "p1", title: title, isComplete: isComplete, dueDate: dueDate, note: note)
}
```

Create AddProjectNameViewController:

```swift
import UIKit

class AddProjectNameViewController: UIViewController, UITextFieldDelegate {
    @IBOutlet weak var tableView: UITableView!
    @IBOutlet weak var textField: UITextField!
    
    override func viewDidLoad() {
        super.viewDidLoad()
        registerForKeyNotification()
    }
    
    func registerForKeyNotification() {
        NotificationCenter.default.addObserver(self, selector: #selector(keyboardWasShown(_:)), name: NSNotification.Name.UIKeyboardDidShow, object: nil)
        NotificationCenter.default.addObserver(self, selector: #selector(keyboardWillBeHidden(_:)), name: NSNotification.Name.UIKeyboardWillHide, object: nil)
    }
    
    @objc func keyboardWasShown(_ notification: NSNotification) {
        guard let info = notification.userInfo, let keyboardFrameValue = info[UIKeyboardFrameBeginUserInfoKey] as? NSValue else { return }
        let keyboardFrame = keyboardFrameValue.cgRectValue
        let tableViewWithKeyboardContentInsets = UIEdgeInsets(top: 0.0, left: 0.0, bottom: keyboardFrame.size.height, right: 0.0)
        tableView.contentInset = tableViewWithKeyboardContentInsets
    }
    
    @objc func keyboardWillBeHidden(_ notification: NSNotification) {
        let contentInsets = UIEdgeInsets.zero
        tableView.contentInset = contentInsets
        tableView.scrollIndicatorInsets = contentInsets
    }
    
    func textFieldShouldReturn(_ textField: UITextField) -> Bool {
        textField.resignFirstResponder()
    }
}
```

Build and run.

![Screen Recording 2020-11-01 at 1 45 23 2020-11-01 01_46_52](https://user-images.githubusercontent.com/24994818/97797630-28723980-1be4-11eb-94ac-8e5b5735548e.gif) 

# 20. [Replace to Plus sign in CalendarView](https://github.com/c4arl0s/ChronoList#chronolist---content)

At this stage, Xcode 12.2 was released so I had to deployed the target to iOS 14.2

Use AddButton.swift file to customize each button.

![Screen Shot 2020-12-12 at 18 33 05](https://user-images.githubusercontent.com/24994818/102000035-8c3e5680-3ca8-11eb-980c-fa7e94404aa1.png)

![Screen Shot 2020-12-12 at 18 34 09](https://user-images.githubusercontent.com/24994818/102000052-aaa45200-3ca8-11eb-91cf-dce7b37c733e.png)  

```swift
import UIKit
@IBDesignable       

class AddButton: UIButton {
    @IBInspectable var fillColor: UIColor = UIColor.orange
    private var halfWidth: CGFloat {
        return bounds.width / 2
    }
    private var halfHeight: CGFloat {
        return bounds.height / 2
    }
    
    override func draw(_ rect: CGRect) {
        let bezierPath = UIBezierPath(ovalIn: rect)
        fillColor.setFill()
        bezierPath.fill()
        let plusWidth: CGFloat = min(bounds.width, bounds.height)*0.6
        let halfPlusWidth = plusWidth / 2
        let plusPath = UIBezierPath()
        plusPath.lineWidth = 4.0
        plusPath.move(to: CGPoint(x: halfWidth - halfPlusWidth, y: halfHeight))
        plusPath.addLine(to: CGPoint(x: halfWidth + halfPlusWidth, y: halfHeight))
        plusPath.move(to: CGPoint(x: halfWidth, y: halfHeight-halfPlusWidth))
        plusPath.addLine(to: CGPoint(x: halfWidth, y: halfHeight+halfPlusWidth))
        UIColor.white.setStroke()
        plusPath.stroke()
    }
    
    func pulsate() {
        let pulse = CASpringAnimation(keyPath: "transform.scale")
        pulse.duration = 0.5
        pulse.fromValue = 0.98
        pulse.toValue = 1.1
        pulse.initialVelocity = 1.0
        pulse.damping = 1.0
        layer.add(pulse, forKey: nil)
    }
}
```

Build and run.

![Screen Shot 2020-12-12 at 18 31 44](https://user-images.githubusercontent.com/24994818/102000010-50a38c80-3ca8-11eb-9d06-ce8390a5b618.png)

# 21. [Modify the number of Tasks](https://github.com/c4arl0s/ChronoList#chronolist---content)

As you know, day has 8 official hours to work, modify **CalendarView** to show 8 hours plus 2 hours to eat.

1. As you know, you used Stack views to create **CalendarView**, You just copy/paste a row to increase the number of tasks and change the labels corresponding to the hour.

![Screen Shot 2020-12-16 at 16 53 15](https://user-images.githubusercontent.com/24994818/102416335-40005880-3fbf-11eb-9f6a-0999c3408c13.png)

2. Build and run.

![Screen Shot 2020-12-16 at 16 55 02](https://user-images.githubusercontent.com/24994818/102416453-75a54180-3fbf-11eb-8c12-651e7a5bbe15.png)

At this stage, The render and update auto layout failed.

# 22. [Modify Add button according to design](https://github.com/c4arl0s/ChronoList#chronolist---content)

The new design paints an outside ring, in the center paints a plus sign.

1. First paint the outside ring:

```swift
let center = CGPoint(x: bounds.width/2, y: bounds.height/2)
let radius: CGFloat = min(bounds.width/2, bounds.height/2)
let startAngle: CGFloat = 0.0
let endAngle: CGFloat = .pi*2
let path = UIBezierPath(arcCenter: center, radius: radius, startAngle: startAngle, endAngle: endAngle, clockwise: true)
path.lineWidth = 2.0
plusColor.setStroke()
path.stroke()
```

2. Second, it paints the plus sign

```swift
let plusWidth: CGFloat = min(bounds.width, bounds.height)*0.6
let halfPlusWidth = plusWidth/2
let plusPath = UIBezierPath()
plusPath.lineWidth = 3.0
plusPath.move(to: CGPoint(x: halfWidth - halfPlusWidth, y: halfHeight))
plusPath.addLine(to: CGPoint(x: halfWidth + halfPlusWidth, y: halfHeight))
plusPath.move(to: CGPoint(x: halfWidth, y: halfHeight-halfPlusWidth))
plusPath.addLine(to: CGPoint(x: halfWidth, y: halfHeight+halfPlusWidth))
UIColor.black.setStroke()
plusColor.setStroke()
plusPath.stroke()
```

3. Build and run:

![Screen Shot 2020-12-17 at 18 19 41](https://user-images.githubusercontent.com/24994818/102559023-778d0480-4094-11eb-8465-8d4de559f921.png)

4. This time it paints correctly the size of the button, It was solve changing the size of the radious:

```swift
let radius: CGFloat = min(bounds.width/2, bounds.height/2)
```

# 23. [Add SegmentedControl according to new Design](https://github.com/c4arl0s/ChronoList#chronolist---content)

According to new design, insert an segmented control to the toolbar, then you are going to show Yesterday, tomorrow and today controls. Remove the add button on toolbar.

We are going to use segmented control to filter toDo list by date (yesterday, today and tomorrow). We also add a Segmented control to Last, Current and Next Week:

![Screen Shot 2020-12-19 at 23 13 34](https://user-images.githubusercontent.com/24994818/102705698-ee223180-424f-11eb-863a-a243b4f0522e.png)


# 24. [Add a row in CalendarView to show the day number](https://github.com/c4arl0s/ChronoList#chronolist---content)

![Screen Shot 2020-12-19 at 23 39 01](https://user-images.githubusercontent.com/24994818/102706005-6f2ef800-4253-11eb-81ff-ad99e8c54b2c.png)

# 25. [Move hour Labels to the right](https://github.com/c4arl0s/ChronoList#chronolist---content)

You just move the hour label to the lowest place in the stack view.

![Screen Shot 2020-12-21 at 6 28 47](https://user-images.githubusercontent.com/24994818/102777239-cd440400-4355-11eb-9e01-944b2cb7e396.png)

# 26. [Create a dayFilterSegmentedControl UISegmentedControl](https://github.com/c4arl0s/ChronoList#chronolist---content)

1. In ToDoViewController declare an UISegmentedControl object and connect it to canvas. This would filter an specific day of the week, in this case we will filter today, yesterday and tomorrow.

```swift
@IBOutlet weak var dayFilterSegmentedControl: UISegmentedControl!
```

It is not needed at this stage, but it is done !

2. In ToDoViewController create an IBAction for the segmented control UISegmentedControl and connect it to canvas, act.

```swift
@IBAction func filterOptionUpdated(_ sender: UISegmentedControl) {

}
```

3. Create a method to create a new array of toDos that correspond the day and connect it to canvas:


```swift
@IBAction func filterOptionUpdated(_ sender: UISegmentedControl) {
    updateMatchingToDos()
}
```

4. Write updateMatchingToDos method, first, we need empty the toDos array and reload data each time the segmented control change.

```swift
func updateMatchingToDos() {
    toDos = []
    self.tableView.reloadData()
}
```

![Screen Recording 2020-12-22 at 12 46 59 2020-12-22 12_47_50](https://user-images.githubusercontent.com/24994818/102922629-f054dd80-4453-11eb-8485-4e21b73a126a.gif)

# 27. [Create filter function for Today, Yesterday and Tomorrow](https://github.com/c4arl0s/ChronoList#chronolist---content)

1. Create array of day options:

```swift
let dayOptions = ["Yesterday", "Today", "Tomorrow"];
```

2. Create day option variable, initialize to "Yesterday"

```swift
var dayOption: String = "Yesterday"
```

3. Create an global instance of Calendar:

```swift
let calendar: Calendar = {
    var calendar = Calendar.current
    calendar.timeZone = TimeZone.current
    return calendar
}()
```

4. Create a function loadToDos(), in this function load toDos in order if there are saved toDos or if there is no saved todos, load them from samples. After that, you have to checked the value of dayOption according to selected Segmented index and then filter each toDo with its corresponding array.

```swift
func loadToDos() {
    if let unwrappedToDos = ToDo.loadToDos() {
        toDos = unwrappedToDos
    } else {
        toDos = ToDo.loadSampleToDos()
    }
    dayOption = dayOptions[dayFilterSegmentedControl.selectedSegmentIndex]
    switch dayOption {
    case "Today":
        todayToDos = filterToDosFromToday(toDos: toDos)
    case "Yesterday":
        yesterdayToDos = filterToDosFromYesterday(toDos: toDos)
    case "Tomorrow":
        tomorrowToDos = filterToDosFromTomorrow(toDos: toDos)
    case "All":
        allToDos = toDos
    default:
        allToDos = toDos
    }
}
```

5. Each time you tap the segmentd control you have to update the number of rows in section and the cell for row at indexPath:

```swift
func tableView(_ tableView: UITableView, numberOfRowsInSection section: Int) -> Int {
    dayOption = dayOptions[dayFilterSegmentedControl.selectedSegmentIndex];
    switch dayOption {
    case "Today":
        return todayToDos.count
    case "Yesterday":
        return yesterdayToDos.count
    case "Tomorrow":
        return tomorrowToDos.count
    default:
        return toDos.count
    }
}

func tableView(_ tableView: UITableView, cellForRowAt indexPath: IndexPath) -> UITableViewCell {
    guard let cell = tableView.dequeueReusableCell(withIdentifier: PropertyKeys.ToDoCellIdentifier) as? ToDoTableViewCell else { fatalError("Could not dequeue a cell") }
    cell.delegate = self
    dayOption = dayOptions[dayFilterSegmentedControl.selectedSegmentIndex];
    switch dayOption {
    case "Today":
        let toDo = todayToDos[indexPath.row]
        cell.titleTextField?.text = toDo.title
        cell.isCompleteButton.isSelected = toDo.isComplete
    case "Yesterday":
        let toDo = yesterdayToDos[indexPath.row]
        cell.titleTextField?.text = toDo.title
        cell.isCompleteButton.isSelected = toDo.isComplete
    case "Tomorrow":
        let toDo = tomorrowToDos[indexPath.row]
        cell.titleTextField?.text = toDo.title
        cell.isCompleteButton.isSelected = toDo.isComplete
    default:
        let toDo = toDos[indexPath.row]
        cell.titleTextField?.text = toDo.title
        cell.isCompleteButton.isSelected = toDo.isComplete
    }
    return cell
}
```

6. Update `updateMatchingToDos` method:

```swift
func updateMatchingToDos() {
    dayOption = dayOptions[dayFilterSegmentedControl.selectedSegmentIndex];
    switch dayOption {
    case "Today":
        todayToDos = self.filterToDosFromToday(toDos: toDos)
    case "Yesterday":
        yesterdayToDos = self.filterToDosFromYesterday(toDos: toDos)
    case "Tomorrow":
        tomorrowToDos = self.filterToDosFromTomorrow(toDos: toDos)
    case "All":
        allToDos = toDos
    default:
        toDos = []
    }
    self.tableView.reloadData()
}
```

7. Create each method to filter suitable array of ToDos

```swift
func filterToDosFromToday(toDos: [ToDo]) -> [ToDo] {
    todayToDos = []
    for toDo in toDos {
        if calendar.isDateInToday(toDo.dueDate) {
            todayToDos.append(toDo)
        }
    }
    return todayToDos
}

func filterToDosFromYesterday(toDos: [ToDo]) -> [ToDo] {
    yesterdayToDos = []
    for toDo in toDos {
        if calendar.isDateInYesterday(toDo.dueDate) {
            yesterdayToDos.append(toDo)
        }
    }
    return yesterdayToDos
}

func filterToDosFromTomorrow(toDos: [ToDo]) -> [ToDo] {
    tomorrowToDos = []
    for toDo in toDos {
        if calendar.isDateInTomorrow(toDo.dueDate) {
            tomorrowToDos.append(toDo)
        }
    }
    return tomorrowToDos
}
```

8. Remember to declare global array variables to hold suitable values, Use ToDo.swift file


```swift
var toDos = [ToDo]()
var todayToDos = [ToDo]()
var yesterdayToDos = [ToDo]()
var tomorrowToDos = [ToDo]()
var allToDos = [ToDo]()
```

9. Build and run. Each time you tap the segmented control, you can see filtered each group of arrays:

![Screen Recording 2020-12-23 at 12 15 39 2020-12-23 12_16_47](https://user-images.githubusercontent.com/24994818/103026082-bdc0e880-4518-11eb-9299-47a13ae7df5c.gif)

# 28. [When you tap any cell, you have to inject the correct ToDo object, according to suitable array](https://github.com/c4arl0s/ChronoList#chronolist---content)

There is a problem when you tap any cell, the object that is injected in **NewTodoViewController** is not suitable. To fix this, you have to pass the correct object instance. In `prepare(segue:,sender:)` method, inject the correct object instance:

```swift
override func prepare(for segue: UIStoryboardSegue, sender: Any?) {
    if segue.identifier == PropertyKeys.ShowDetailsToDo {
        let toDoViewController = segue.destination as! NewToDoViewController
        let selectedIndexPath = tableView.indexPathForSelectedRow!
        dayOption = dayOptions[dayFilterSegmentedControl.selectedSegmentIndex];
        var selectedToDo: ToDo
        switch dayOption {
        case "Today":
            selectedToDo = todayToDos[selectedIndexPath.row]
        case "Yesterday":
            selectedToDo = yesterdayToDos[selectedIndexPath.row]
        case "Tomorrow":
            selectedToDo = tomorrowToDos[selectedIndexPath.row]
        case "All":
            selectedToDo = toDos[selectedIndexPath.row]
        default:
            preconditionFailure("No day option value")
        }
        toDoViewController.toDo = selectedToDo
    }
}
```

![Screen Recording 2020-12-23 at 22 44 29 2020-12-23 22_46_07](https://user-images.githubusercontent.com/24994818/103061349-b6c5c480-4570-11eb-87eb-0ee94f850cdb.gif)

# 29. [When you create a new ToDo, save it correctly and show it in table view](https://github.com/c4arl0s/ChronoList#chronolist---content)

The issue was solved modifying `unwindToToDoList(segue:)`, just right after you check that there is no selectedIndexPath:

```swift
@IBAction func unwindToToDoList(segue: UIStoryboardSegue) {
    switch segue.identifier {
    case PropertyKeys.SaveUnwind:
        let sourceViewController = segue.source as! NewToDoViewController
        if let toDo = sourceViewController.toDo {
            if let selectedIndexPath = tableView.indexPathForSelectedRow {
                toDos[selectedIndexPath.row] = toDo
                tableView.reloadRows(at: [selectedIndexPath], with: .none)
                tableView.deselectRow(at: selectedIndexPath, animated: true)
            } else {
                var newIndexPath: IndexPath
                dayOption = dayOptions[dayFilterSegmentedControl.selectedSegmentIndex]
                if dayOption == day(dueDate: toDo.dueDate) {
                    switch dayOption {
                    case "Today":
                        newIndexPath = IndexPath(row: todayToDos.count, section: 0)
                        todayToDos.append(toDo)
                    case "Yesterday":
                        newIndexPath = IndexPath(row: yesterdayToDos.count, section: 0)
                        yesterdayToDos.append(toDo)
                    case "Tomorrow":
                        newIndexPath = IndexPath(row: tomorrowToDos.count, section: 0)
                        tomorrowToDos.append(toDo)
                    case "All":
                        newIndexPath = IndexPath(row: allToDos.count, section: 0)
                        allToDos.append(toDo)
                    default:
                        preconditionFailure("No day option")
                    }
                    tableView.insertRows(at: [newIndexPath], with: .automatic)
                }
                toDos.append(toDo)
            }
            ToDo.saveToDos(toDos)
        }
    case PropertyKeys.CancelUnwind:
        if let selectedIndexPath = tableView.indexPathForSelectedRow {
            tableView.deselectRow(at: selectedIndexPath, animated: true)
        }
    default:
        preconditionFailure("No segue identified")
    }
}
```

![Screen Recording 2020-12-27 at 8 49 07 2020-12-27 08_52_39](https://user-images.githubusercontent.com/24994818/103173486-eac71100-4820-11eb-8d56-cd74558b20bc.gif)

# 30. [Change Project's name](https://github.com/c4arl0s/ChronoList#chronolist---content)

After a while, [I created a documentation project to remember the steps to change Project's name in Xcode](https://github.com/c4arl0s/RenamingAnXcodeProject#renaming-an-xcode-project)

![Screen Shot 2020-12-27 at 9 32 53](https://user-images.githubusercontent.com/24994818/103174298-8a3ad280-4826-11eb-835a-871993b9785e.png)

# 31. [Write ToDoController, basic functionality.]()

```swift
import Foundation

enum SavingToDoResult {
    case success
    case failure(Error)
    case failureCreatingEncoder(Error)
    case failureWritingData(Error)
}

enum URLError: Error {
    case invalidURL
}

enum DataError: Error {
    case invalidData
}

enum LoadingToDoResult {
    case success([ToDo]?)
    case failureInvalidURL(URLError)
    case failureInvalidData(DataError)
}

class ToDoController {
    static let shared = ToDoController()
    static let DocumentsDirectory = FileManager.default.urls(for: .documentDirectory, in: .userDomainMask).first!
    static let ArchiveURL = DocumentsDirectory.appendingPathComponent("todos").appendingPathExtension("plist")
    
    func loadToDos(completion: @escaping (LoadingToDoResult) -> Void) {
        var codedToDos: Data
        do {
            codedToDos = try Data(contentsOf: ToDoController.ArchiveURL)
        } catch {
            return completion(.failureInvalidURL(.invalidURL))
        }
        do {
            let propertyListDecoder = PropertyListDecoder()
            let toDos = try propertyListDecoder.decode(Array<ToDo>.self, from: codedToDos)
            return completion(.success(toDos))
        } catch {
            return completion(.failureInvalidData(.invalidData))
        }
    }
    
    func saveToDos(toDos: [ToDo]) -> SavingToDoResult {
        let propertyListEncoder = PropertyListEncoder()
        var codedToDos: Data
        do {
            codedToDos = try propertyListEncoder.encode(toDos)
        } catch let error {
            return .failureCreatingEncoder(error)
        }
        do {
            try codedToDos.write(to: ToDoController.ArchiveURL, options: .noFileProtection)
            return .success
        } catch let error {
            return .failureWritingData(error)
        }
    }
    
    static func loadSampleToDos() -> [ToDo] {
        let todo1 = ToDo(projectName: "para antier", title: "Para antier", isComplete: false, dueDate: Date().addingTimeInterval(-2*(24*60*60)), note: "para antier")
        let todo2 = ToDo(projectName: "para ayer", title: "para ayer", isComplete: false, dueDate: Date().addingTimeInterval(-24*60*60), note: "Sample Note 2")
        let todo3 = ToDo(projectName: "para hoy", title: "Para Hoy", isComplete: false, dueDate: Date(), note: "Sample Note 3")
        let todo4 = ToDo(projectName: "para ma単ana", title: "Para ma単ana", isComplete: false, dueDate: Date().addingTimeInterval(24*60*60), note: "Sample Note 4")
        let todo5 = ToDo(projectName: "para pasado ma単ana", title: "para pasado ma単ana", isComplete: false, dueDate: Date().addingTimeInterval(2*24*60*60), note: "Sample Note 5")
        return [todo1, todo2, todo3, todo4, todo5]
    }
}

```

# 32. [Fix the AddButton.swift file again](https://github.com/c4arl0s/ChronoList#chronolist---content)

Xcode couldn't find AddButton.swift class because according to Xcode was located in another disk, fatal error because the file was in another hardisk that was unmounted, I had to look in documentations [Modify Add button according to design](https://github.com/c4arl0s/ChronoList#22-modify-add-button-according-to-design) to rewrite the code. Again, I put the solution here to document again.:

AddButton.swift file:

```swift
import UIKit
@IBDesignable

class AddButton: UIButton {
    @IBInspectable var fillColor: UIColor = UIColor.orange
    private var halfWidth: CGFloat {
        return bounds.width / 2
    }
    private var halfHeight: CGFloat {
        return bounds.height / 2
    }
    
    override func draw(_ rect: CGRect) {
        // first paint the outside ring
        let center = CGPoint(x: bounds.width/2, y: bounds.height/2)
        let radius: CGFloat = min(bounds.width/2, bounds.height/2)
        let startAngle: CGFloat = 0.0
        let endAngle: CGFloat = .pi*2
        let path = UIBezierPath(arcCenter: center, radius: radius, startAngle: startAngle, endAngle: endAngle, clockwise: true)
        path.lineWidth = 2.0
        fillColor.setStroke()
        path.stroke()
        // Second, it paints the plus sign
        let plusWidth: CGFloat = min(bounds.width, bounds.height)*0.6
        let halfPlusWidth = plusWidth/2
        let plusPath = UIBezierPath()
        plusPath.lineWidth = 3.0
        plusPath.move(to: CGPoint(x: halfWidth - halfPlusWidth, y: halfHeight))
        plusPath.addLine(to: CGPoint(x: halfWidth + halfPlusWidth, y: halfHeight))
        plusPath.move(to: CGPoint(x: halfWidth, y: halfHeight-halfPlusWidth))
        plusPath.addLine(to: CGPoint(x: halfWidth, y: halfHeight+halfPlusWidth))
        UIColor.black.setStroke()
        fillColor.setStroke()
        plusPath.stroke()
    }
    
    func pulsate() {
        let pulse = CASpringAnimation(keyPath: "transform.scale")
        pulse.duration = 0.5
        pulse.fromValue = 0.98
        pulse.toValue = 1.1
        pulse.initialVelocity = 1.0
        pulse.damping = 1.0
        layer.add(pulse, forKey: nil)
    }
}
```

![Screen Shot 2021-03-23 at 20 09 20](https://user-images.githubusercontent.com/24994818/112243742-b55d7400-8c13-11eb-968d-475adb3ad12f.png)

# 33. [git reset --hard ba0e0b2](https://github.com/c4arl0s/ChronoList/tree/ToDoController#chronolist---content)

Reset project to a version where the ToDo objects were saved in one only array. I also fixed the missing AddButton.swift file.

![Screen Shot 2021-03-26 at 8 22 40](https://user-images.githubusercontent.com/24994818/112645809-7b0af700-8e0c-11eb-972c-59ae42063fa2.png)

Remember to schedule new commits to rewrite important things you were doing. (ToDoController, rename Project).

# 34. [Rename project to ChronoList again](https://github.com/c4arl0s/ChronoList/tree/ToDoController#chronolist---content)

Follow the steps to rename projects in Xcode [link](https://github.com/c4arl0s/RenamingAnXcodeProject#renaming-an-xcode-project)

# 35. [Rename Targets to ChronoList, ChronoListTests, and ChronoListUITests](https://github.com/c4arl0s/ChronoList/tree/ToDoController#chronolist---content)

Follow the steps to rename targets, do not forget to document the new Info.plist file path  to successfully change the target's name.

# 36. [Write ToDoController in a new brach, basic functionality, again](https://github.com/c4arl0s/ChronoList/tree/ToDoController#chronolist---content)

In this swift file, you are going to create an object that is in charge of share a single instance of the object. Load and save ToDo objects.

```swift
import Foundation

enum SavingToDoResult {
    case success
    case failure(Error)
    case failureCreatingEncoder(Error)
    case failureWritingData(Error)
}

enum URLError: Error {
    case invalidURL
}

enum DataError: Error {
    case invalidData
}

enum LoadingToDoResult {
    case success([ToDo]?)
    case failureInvalidURL(URLError)
    case failureInvalidData(DataError)
}

class ToDoController {
    static let shared = ToDoController()
    static let DocumentsDirectory = FileManager.default.urls(for: .documentDirectory, in: .userDomainMask).first!
    static let ArchiveURL = DocumentsDirectory.appendingPathComponent("todos").appendingPathExtension("plist")
    
    func loadToDos(completion: @escaping (LoadingToDoResult) -> Void) {
        var codedToDos: Data
        do {
            codedToDos = try Data(contentsOf: ToDoController.ArchiveURL)
        } catch {
            return completion(.failureInvalidURL(.invalidURL))
        }
        do {
            let propertyListDecoder = PropertyListDecoder()
            let toDos = try propertyListDecoder.decode(Array<ToDo>.self, from: codedToDos)
            return completion(.success(toDos))
        } catch {
            return completion(.failureInvalidData(.invalidData))
        }
    }
    
    func saveToDos(toDos: [ToDo]) -> SavingToDoResult {
        let propertyListEncoder = PropertyListEncoder()
        var codedToDos: Data
        do {
            codedToDos = try propertyListEncoder.encode(toDos)
        } catch let error {
            return .failureCreatingEncoder(error)
        }
        do {
            try codedToDos.write(to: ToDoController.ArchiveURL, options: .noFileProtection)
            return .success
        } catch let error {
            return .failureWritingData(error)
        }
    }
    
    static func loadSampleToDos() -> [ToDo] {
        let todo1 = ToDo(projectName: "para antier", title: "Para antier", isComplete: false, dueDate: Date().addingTimeInterval(-2*(24*60*60)), note: "para antier")
        let todo2 = ToDo(projectName: "para ayer", title: "para ayer", isComplete: false, dueDate: Date().addingTimeInterval(-24*60*60), note: "Sample Note 2")
        let todo3 = ToDo(projectName: "para hoy", title: "Para Hoy", isComplete: false, dueDate: Date(), note: "Sample Note 3")
        let todo4 = ToDo(projectName: "para ma単ana", title: "Para ma単ana", isComplete: false, dueDate: Date().addingTimeInterval(24*60*60), note: "Sample Note 4")
        let todo5 = ToDo(projectName: "para pasado ma単ana", title: "para pasado ma単ana", isComplete: false, dueDate: Date().addingTimeInterval(2*24*60*60), note: "Sample Note 5")
        return [todo1, todo2, todo3, todo4, todo5]
    }
}

```

# 37. [Use ToDoController to save and load ToDo objects](https://github.com/c4arl0s/ChronoList#chronolist---content)

After learn how to use enumerations, I am able to use them in ToDoViewController.swift file. First I had to modify load and save toDos methods:

First version of load toDos:

```swift
func prototypeMark1LoadToDos(completion: @escaping (LoadToDoResult) -> Void) {
    var codedToDos: Data
    do {
        codedToDos = try Data(contentsOf: ToDoController.ArchiveURL)
    } catch let error {
        return completion(.failureInvalidURL(error as! URLError))
    }
    let propertyListDecoder = PropertyListDecoder()
    if let toDos = try? propertyListDecoder.decode(Array<ToDo>.self, from: codedToDos) {
        return completion(.success(toDos))
    } else {
        return completion(.failureInvalidData("System couldn't decode"))
    }
}
```

Second version of load toDos:

```swift
func prototypeMark2LoadToDos() -> [ToDo]? {
    var codedToDos: Data
    do {
        codedToDos = try Data(contentsOf: ToDoController.ArchiveURL)
    } catch {
        return nil
    }
    do {
        let propertyListDecoder = PropertyListDecoder()
        let toDos = try propertyListDecoder.decode(Array<ToDo>.self, from: codedToDos)
        return toDos
    } catch {
        return nil
    }
}
```

I used first version in ToDoViewController.swift file:

First in `viewDidLoad()`:

```swift
override func viewDidLoad() {
    tableView.delegate = self
    tableView.register(UINib(nibName: "ToDoTableViewCell", bundle: nil), forCellReuseIdentifier: "ToDoCellIdentifier")
    editBarButtonItem.title = "Edit"
    ToDoController.shared.prototypeMark1LoadToDos { (LoadToDoResult) in
        switch LoadToDoResult {
        case .success(let obteinedToDos):
            toDos = obteinedToDos
        case .failureInvalidData(let message):
            print("\(message)")
            toDos = ToDoController.loadSampleToDos()
        case .failureInvalidURL(let urlError):
            print("\(urlError.localizedDescription)")
            toDos = ToDoController.loadSampleToDos()
        }
    }
    loadCalendarView()
}
```

Second in delegate method `tableView(_ tableView:,editingStyle:,indexPath:)`:

```swift
func tableView(_ tableView: UITableView, commit editingStyle: UITableViewCellEditingStyle, forRowAt indexPath: IndexPath) {
    if editingStyle == .delete {
        let title = "Delete"
        let name = toDos[indexPath.row].title
        let messageFormatted = String(format: "delete: \(name)  ?", name)
        let alertController = UIAlertController(title: title, message: messageFormatted, preferredStyle: .actionSheet)
        let destructiveAction = UIAlertAction(title: "Delete", style: .destructive) { (_) in
            toDos.remove(at: indexPath.row)
            tableView.deleteRows(at: [indexPath], with: .fade)
            switch ToDoController.shared.saveToDos(toDos: toDos) {
            case .success:
                print("success writing data after editing")
            case .failureWritingData(let error):
                print("failure writing data, \(error)", error.localizedDescription)
            case .failureCreatingEncoder(let error):
                print("failure creating encoder, \(error)", error.localizedDescription)
            }
        }
        let cancelAction = UIAlertAction(title: "Cancel", style: .cancel, handler: nil)
        alertController.addAction(destructiveAction)
        alertController.addAction(cancelAction)
        present(alertController, animated: true, completion: nil)
    }
}
```

Third in `unwindToToDoList(segue:)`:

```swift
@IBAction func unwindToToDoList(segue: UIStoryboardSegue) {
    switch segue.identifier {
    case PropertyKeys.SaveUnwind:
        let sourceViewController = segue.source as! NewToDoViewController
        if let toDo = sourceViewController.toDo {
            if let selectedIndexPath = tableView.indexPathForSelectedRow {
                toDos[selectedIndexPath.row] = toDo
                tableView.reloadRows(at: [selectedIndexPath], with: .none)
                tableView.deselectRow(at: selectedIndexPath, animated: true)
            } else {
                let newIndexPath = IndexPath(row: toDos.count, section: 0)
                toDos.append(toDo)
                tableView.insertRows(at: [newIndexPath], with: .automatic)
            }
            switch ToDoController.shared.saveToDos(toDos: toDos) {
            case .success:
                print("success writing data after edit complete object")
            case .failureWritingData(let error):
                print("failure writing data, \(error)", error.localizedDescription)
            case .failureCreatingEncoder(let error):
                print("failure creating encoder, \(error)", error.localizedDescription)
            }
        }
    case PropertyKeys.CancelUnwind:
        if let selectedIndexPath = tableView.indexPathForSelectedRow {
        tableView.deselectRow(at: selectedIndexPath, animated: true)
        }
    default:
        preconditionFailure("No segue identified")
    }
}
```

Finally in `checkmarkTapped(sender:)`:

```swift
func checkmarkTapped(sender: ToDoTableViewCell) {
    if let indexPath = tableView.indexPath(for: sender) {
        var toDo = toDos[indexPath.row]
        toDo.isComplete = !toDo.isComplete
        toDos[indexPath.row] = toDo
        tableView.reloadRows(at: [indexPath], with: .automatic)
        switch ToDoController.shared.saveToDos(toDos: toDos) {
        case .success:
            print("success writing data after tap checkmark")
        case .failureWritingData(let error):
            print("failure writing data, \(error)", error.localizedDescription)
        case .failureCreatingEncoder(let error):
            print("failure creating encoder, \(error)", error.localizedDescription)
        }
    }
}
```

After a few test, the save and load methods work correctly:

![Screen Shot 2021-03-30 at 7 39 15](https://user-images.githubusercontent.com/24994818/112998220-13fe8280-912b-11eb-9ed8-4439513bc498.png)

# 38. [Create function to filter yesterday ToDos in ToDoController](https://github.com/c4arl0s/ChronoList#chronolist---content)

1, Create an enumeration with the option day:

```swift
enum OptionDay {

    case yesterday, today, tomorrow

}
```

2. In order to get a filtered list of ToDo, create a function in ToDoController, this would help us to filter for each option day:

```swift
func toDosFor(optionDay: OptionDay, toDos: [ToDo]) -> [ToDo] {

    var selectedTodos: [ToDo] = []
    let calendar: Calendar = {
        var calendar = Calendar.current
        calendar.timeZone = TimeZone.current
        return calendar
    }()
    switch optionDay {
    case .today:
        for toDo in toDos {
            if calendar.isDateInToday(toDo.dueDate) {
                selectedTodos.append(toDo)
            }
        }
    case .tomorrow:
        for toDo in toDos {
            if calendar.isDateInTomorrow(toDo.dueDate) {
                selectedTodos.append(toDo)
            }
        }
    case .yesterday:
        for toDo in toDos {
            if calendar.isDateInYesterday(toDo.dueDate) {
                selectedTodos.append(toDo)
            }
        }
    }
    return selectedTodos

}
```

3. Use this function right away after get the complete ToDo objects in `viewDidLoad()

```swift
override func viewDidLoad() {
    
    tableView.delegate = self
    tableView.register(UINib(nibName: "ToDoTableViewCell", bundle: nil), forCellReuseIdentifier: "ToDoCellIdentifier")
    editBarButtonItem.title = "Edit"
    ToDoController.shared.prototypeMark1LoadToDos { (LoadToDoResult) in
        switch LoadToDoResult {
        case .success(let obteinedToDos):
            self.toDos = ToDoController.shared.toDosFor(optionDay: .today, toDos: obteinedToDos) // filter ToDo
        case .failureInvalidData(let message):
            print("\(message)")
            self.toDos = ToDoController.loadSampleToDos()
        case .failureInvalidURL(let urlError):
            print("\(urlError.localizedDescription)")
            self.toDos = ToDoController.loadSampleToDos()
        }
    }
    loadCalendarView()
    
}
```

Build and run, the ToDo array for today will be display.

# 39. [When you tap Yesterday Segmented COntrol button, update table to show yesterday ToDo](https://github.com/c4arl0s/ChronoList#chronolist---content)

1. In ToDoViewController declare an UISegmentedControl object and connect it to canvas. This would filter an specific day of the week, in this case we will filter today, yesterday and tomorrow.

```swift
@IBOutlet weak var optionDaySegmentedControl: UISegmentedControl!
```
2. In ToDoViewController create an IBAction for the segmented control UISegmentedControl and connect it to canvas, act.

```swift
@IBAction func toDosForSelectedDay(_ sender: UISegmentedControl) {
    
    var updatedToDos = [ToDo]()
    ToDoController.shared.prototypeMark1LoadToDos { (LoadToDoResult) in
        switch LoadToDoResult {
        case .success(let obteinedToDos):
            updatedToDos = obteinedToDos
        case .failureInvalidData(let message):
            print("\(message)")
            self.toDos = ToDoController.loadSampleToDos()
        case .failureInvalidURL(let urlError):
            print("\(urlError.localizedDescription)")
            self.toDos = ToDoController.loadSampleToDos()
        }
    }
    switch sender.selectedSegmentIndex {
    case 0:
        self.toDos = ToDoController.shared.toDosFor(optionDay: .yesterday, toDos: updatedToDos)
    case 1:
        self.toDos = ToDoController.shared.toDosFor(optionDay: .today, toDos: updatedToDos)
    case 2:
        self.toDos = ToDoController.shared.toDosFor(optionDay: .tomorrow, toDos: updatedToDos)
    default:
        preconditionFailure("There is no other option")
    }
    tableView.reloadData()
    
}
```

3. Update viewDidLoad to set the selected segment index, also, set a toDoList variable to get the original list of ToDos loaded from disk

```swift
override func viewDidLoad() {
    
    tableView.delegate = self
    tableView.register(UINib(nibName: "ToDoTableViewCell", bundle: nil), forCellReuseIdentifier: "ToDoCellIdentifier")
    editBarButtonItem.title = "Edit"
    ToDoController.shared.prototypeMark1LoadToDos { (LoadToDoResult) in
        switch LoadToDoResult {
        case .success(let obteinedToDos):
            self.toDoList = obteinedToDos
            self.toDos = ToDoController.shared.toDosFor(optionDay: .today, toDos: obteinedToDos) 
            self.optionDaySegmentedControl.selectedSegmentIndex = 1 // set control button to show Today ToDos
        case .failureInvalidData(let message):
            print("\(message)")
            self.toDos = ToDoController.loadSampleToDos()
        case .failureInvalidURL(let urlError):
            print("\(urlError.localizedDescription)")
            self.toDos = ToDoController.loadSampleToDos()
        }
    }
    loadCalendarView()
    
}
```

4. After create a new ToDo object, create a flow to update the tableView:

```swift
@IBAction func unwindToToDoList(segue: UIStoryboardSegue) {
    
    switch segue.identifier {
    case PropertyKeys.SaveUnwind:
        let sourceViewController = segue.source as! NewToDoViewController
        if let toDo = sourceViewController.toDo {
            if let selectedIndexPath = tableView.indexPathForSelectedRow {
                toDos[selectedIndexPath.row] = toDo
                tableView.reloadRows(at: [selectedIndexPath], with: .none)
                tableView.deselectRow(at: selectedIndexPath, animated: true)
            } else {
                let newIndexPath = IndexPath(row: toDos.count, section: 0)
                toDos.append(toDo)
                // use a function that tells me if it is tomorrow, today or yesterday
                let calendar: Calendar = {
                    var calendar = Calendar.current
                    calendar.timeZone = TimeZone.current
                    return calendar
                }()
                if calendar.isDateInToday(toDo.dueDate) && optionDaySegmentedControl.selectedSegmentIndex == 1 {
                    tableView.insertRows(at: [newIndexPath], with: .automatic)
                } else if (calendar.isDateInTomorrow(toDo.dueDate) && optionDaySegmentedControl.selectedSegmentIndex == 2) {
                    tableView.insertRows(at: [newIndexPath], with: .automatic)
                } else if (calendar.isDateInYesterday(toDo.dueDate) && optionDaySegmentedControl.selectedSegmentIndex == 0) {
                    tableView.insertRows(at: [newIndexPath], with: .automatic)
                }
            }
            toDoList.append(toDo) // update the first todo list
            switch ToDoController.shared.saveToDos(toDos: toDoList) { // save the original todo list
            case .success:
                print("success writing data after edit complete object")
            case .failureWritingData(let error):
                print("failure writing data, \(error)", error.localizedDescription)
            case .failureCreatingEncoder(let error):
                print("failure creating encoder, \(error)", error.localizedDescription)
            }
        }
    case PropertyKeys.CancelUnwind:
        if let selectedIndexPath = tableView.indexPathForSelectedRow {
        tableView.deselectRow(at: selectedIndexPath, animated: true)
        }
    default:
        preconditionFailure("No segue identified")
    }
}
```

It has several issues right now, but it the target is accomplished. Create new commits.

# 40. [Fix when you add and edit a ToDo object](https://github.com/c4arl0s/ChronoList#chronolist---content)

1. Update ToDo.swift 

```swift
struct ToDo: Codable {
    
    var projectName: String
    var title: String
    var isComplete: Bool
    var dueDate: Date
    var startDate: Date?
    var finishDate: Date?
    var note: String?
    
    init(projectName: String, title: String, isComplete: Bool, dueDate: Date, note: String?)
    {
        self.projectName = projectName
        self.title = title
        self.isComplete = isComplete
        self.dueDate = dueDate
        self.note = note
    }
    
    static let dueDateFormatter: DateFormatter = {
        let formatter = DateFormatter()
        formatter.dateStyle = .short
        formatter.timeStyle = .short
        return formatter
    }()
    
    func categorizedDay() -> OptionDay {
        
        let calendar: Calendar = {
            var calendar = Calendar.current
            calendar.timeZone = TimeZone.current
            return calendar
        }()
        if calendar.isDateInToday(self.dueDate) {
            return .today
        } else if calendar.isDateInTomorrow(self.dueDate) {
            return .tomorrow
        } else if calendar.isDateInYesterday(self.dueDate) {
            return .yesterday
        } else {
            return .otherTime
        }
        
    }
}
```

2. update ToDoController.swift:

```swift
import Foundation

enum SaveToDoResult {
    case success
    case failureCreatingEncoder(Error)
    case failureWritingData(Error)
}

enum URLError: Error {
    case invalidURL
}

enum DataError: Error {
    case invalidData
}

enum LoadToDoResult {
    case success([ToDo])
    case failureInvalidURL(URLError)
    case failureInvalidData(String)
}

class ToDoController {
    
    static let shared = ToDoController()
    static let DocumentsDirectory = FileManager.default.urls(for: .documentDirectory, in: .userDomainMask).first!
    static let ArchiveURL = DocumentsDirectory.appendingPathComponent("todos").appendingPathExtension("plist")
    
    func prototypeMark1LoadToDos(completion: @escaping (LoadToDoResult) -> Void) {
        var codedToDos: Data
        do {
            codedToDos = try Data(contentsOf: ToDoController.ArchiveURL)
        } catch let error {
            return completion(.failureInvalidURL(error as! URLError))
        }
        let propertyListDecoder = PropertyListDecoder()
        if let toDos = try? propertyListDecoder.decode(Array<ToDo>.self, from: codedToDos) {
            return completion(.success(toDos))
        } else {
            return completion(.failureInvalidData("System couldn't decode"))
        }
    }
    
    func prototypeMark2LoadToDos() -> [ToDo]? {
        var codedToDos: Data
        do {
            codedToDos = try Data(contentsOf: ToDoController.ArchiveURL)
        } catch {
            return nil
        }
        do {
            let propertyListDecoder = PropertyListDecoder()
            let toDos = try propertyListDecoder.decode(Array<ToDo>.self, from: codedToDos)
            return toDos
        } catch {
            return nil
        }
    }
    
    func saveToDos(toDos: [ToDo]) -> SaveToDoResult {
        let propertyListEncoder = PropertyListEncoder()
        var codedToDos: Data
        do {
            codedToDos = try propertyListEncoder.encode(toDos)
        } catch let error {
            return .failureCreatingEncoder(error)
        }
        do {
            try codedToDos.write(to: ToDoController.ArchiveURL, options: .noFileProtection)
            return .success
        } catch let error {
            return .failureWritingData(error)
        }
    }
    
    static func loadSampleToDos() -> [ToDo] {
        let todo1 = ToDo(projectName: "para antier", title: "Para antier", isComplete: false, dueDate: Date().addingTimeInterval(-2*(24*60*60)), note: "para antier")
        let todo2 = ToDo(projectName: "para ayer", title: "para ayer", isComplete: false, dueDate: Date().addingTimeInterval(-24*60*60), note: "Sample Note 2")
        let todo3 = ToDo(projectName: "para hoy", title: "Para Hoy", isComplete: false, dueDate: Date(), note: "Sample Note 3")
        let todo4 = ToDo(projectName: "para ma単ana", title: "Para ma単ana", isComplete: false, dueDate: Date().addingTimeInterval(24*60*60), note: "Sample Note 4")
        let todo5 = ToDo(projectName: "para pasado ma単ana", title: "para pasado ma単ana", isComplete: false, dueDate: Date().addingTimeInterval(2*24*60*60), note: "Sample Note 5")
        return [todo1, todo2, todo3, todo4, todo5]
    }
    
    func toDosFor(optionDay: OptionDay, toDos: [ToDo]) -> [ToDo] {
    
        var selectedTodos = [ToDo]()
        let calendar: Calendar = {
            var calendar = Calendar.current
            calendar.timeZone = TimeZone.current
            return calendar
        }()
        switch optionDay {
        case .today:
            for toDo in toDos {
                if calendar.isDateInToday(toDo.dueDate) {
                    selectedTodos.append(toDo)
                }
            }
        case .tomorrow:
            for toDo in toDos {
                if calendar.isDateInTomorrow(toDo.dueDate) {
                    selectedTodos.append(toDo)
                }
            }
        case .yesterday:
            for toDo in toDos {
                if calendar.isDateInYesterday(toDo.dueDate) {
                    selectedTodos.append(toDo)
                }
            }
        case .otherTime:
            for toDo in toDos {
                if !calendar.isDateInYesterday(toDo.dueDate) && !calendar.isDateInToday(toDo.dueDate) && !calendar.isDateInTomorrow(toDo.dueDate) {
                    selectedTodos.append(toDo)
                }
            }
        }
        return selectedTodos
    }
}
```

3. Update ToDoViewController.swift:

```swift
enum OptionDay {

    case yesterday, today, tomorrow, otherTime

}

class ToDoViewController: UIViewController, UITableViewDataSource, UITableViewDelegate, ToDoTableViewCellDelegate {
    
    @IBOutlet weak var tableView: UITableView!
    struct PropertyKeys {
        static let ToDoCellIdentifier = "ToDoCellIdentifier"
        static let ShowDetailsToDo = "ShowDetailsToDo"
        static let SaveUnwind = "SaveUnwind"
        static let CancelUnwind = "CancelUnwind"
    }
    @IBOutlet weak var editBarButtonItem: UIBarButtonItem!
    @IBOutlet weak var calendarView: UIView!
    var optionDay: OptionDay = .today
    var currentToDos = [ToDo]()
    var yesterdayToDos = [ToDo]()
    var todayToDos = [ToDo]()
    var tomorrowToDos = [ToDo]()
    var otherTimeToDos = [ToDo]()
    @IBOutlet weak var optionDaySegmentedControl: UISegmentedControl!

    override func viewDidLoad() {
        
        tableView.delegate = self
        tableView.register(UINib(nibName: "ToDoTableViewCell", bundle: nil), forCellReuseIdentifier: "ToDoCellIdentifier")
        editBarButtonItem.title = "Edit"
        loadToDos()
        loadCalendarView()
        
    }
    
    func loadToDos() {
        ToDoController.shared.prototypeMark1LoadToDos { (LoadToDoResult) in
            switch LoadToDoResult {
            case .success(let obteinedToDos):
                self.currentToDos = obteinedToDos
                self.todayToDos = ToDoController.shared.toDosFor(optionDay: .today, toDos: obteinedToDos)
                self.optionDaySegmentedControl.selectedSegmentIndex = 1
            case .failureInvalidData(let message):
                print("\(message)")
                self.currentToDos = ToDoController.loadSampleToDos()
            case .failureInvalidURL(let urlError):
                print("\(urlError.localizedDescription)")
                self.currentToDos = ToDoController.loadSampleToDos()
            }
        }
    }
    
    func loadCalendarView() {
        
        Bundle.main.loadNibNamed("CalendarView", owner: self, options: nil)
        calendarView.frame.origin = CGPoint(x: 0, y: 55)
        view.addSubview(calendarView)
        
    }
    
    func tableView(_ tableView: UITableView, numberOfRowsInSection section: Int) -> Int {
        
        switch optionDaySegmentedControl.selectedSegmentIndex {
        case 0:
            return yesterdayToDos.count
        case 1:
            return todayToDos.count
        case 2:
            return tomorrowToDos.count
        case 3:
            return otherTimeToDos.count
        default:
            preconditionFailure("unrecognize case")
        }
        
    }
    
    func tableView(_ tableView: UITableView, cellForRowAt indexPath: IndexPath) -> UITableViewCell {
        
        guard let cell = tableView.dequeueReusableCell(withIdentifier: PropertyKeys.ToDoCellIdentifier) as? ToDoTableViewCell else { fatalError("Could not dequeue a cell") }
        var toDo: ToDo
        switch optionDaySegmentedControl.selectedSegmentIndex {
        case 0:
            toDo = yesterdayToDos[indexPath.row]
        case 1:
            toDo = todayToDos[indexPath.row]
        case 2:
            toDo = tomorrowToDos[indexPath.row]
        case 3:
            toDo = otherTimeToDos[indexPath.row]
        default:
            preconditionFailure("unrecognize case")
        }
        cell.titleTextField?.text = toDo.title
        cell.isCompleteButton.isSelected = toDo.isComplete
        cell.delegate = self
        return cell
        
    }
    
    func tableView(_ tableView: UITableView, canEditRowAt indexPath: IndexPath) -> Bool {
        
        return true
        
    }
    
    func tableView(_ tableView: UITableView, commit editingStyle: UITableViewCellEditingStyle, forRowAt indexPath: IndexPath) {
        
        if editingStyle == .delete {
            let title = "Delete"
            var name: String
            switch optionDaySegmentedControl.selectedSegmentIndex {
            case 0:
                name = yesterdayToDos[indexPath.row].title
            case 1:
                name = todayToDos[indexPath.row].title
            case 2:
                name = tomorrowToDos[indexPath.row].title
            case 3:
                name = otherTimeToDos[indexPath.row].title
            default:
                preconditionFailure("unrecognize case")
            }
            let messageFormatted = String(format: "delete: \(name)  ?", name)
            let alertController = UIAlertController(title: title, message: messageFormatted, preferredStyle: .actionSheet)
            let destructiveAction = UIAlertAction(title: "Delete", style: .destructive) { (_) in
                switch self.optionDaySegmentedControl.selectedSegmentIndex {
                case 0:
                    self.yesterdayToDos.remove(at: indexPath.row)
                case 1:
                    self.todayToDos.remove(at: indexPath.row)
                case 2:
                    self.tomorrowToDos.remove(at: indexPath.row)
                case 3:
                    self.otherTimeToDos.remove(at: indexPath.row)
                default:
                    preconditionFailure("unrecognize case")
                }
                tableView.deleteRows(at: [indexPath], with: .fade)
                self.saveCurrentToDos()
            }
            let cancelAction = UIAlertAction(title: "Cancel", style: .cancel, handler: nil)
            alertController.addAction(destructiveAction)
            alertController.addAction(cancelAction)
            present(alertController, animated: true, completion: nil)
        }
    }
    
    func saveCurrentToDos() {
        self.currentToDos.removeAll()
        self.currentToDos = self.yesterdayToDos
        self.currentToDos.append(contentsOf: self.todayToDos)
        self.currentToDos.append(contentsOf: self.tomorrowToDos)
        self.currentToDos.append(contentsOf: self.otherTimeToDos)
        switch ToDoController.shared.saveToDos(toDos: self.currentToDos) {
        case .success:
            print("success writing data after editing")
        case .failureWritingData(let error):
            print("failure writing data, \(error)", error.localizedDescription)
        case .failureCreatingEncoder(let error):
            print("failure creating encoder, \(error)", error.localizedDescription)
        }
    }
    
    @IBAction func unwindToToDoList(segue: UIStoryboardSegue) {
        
        switch segue.identifier {
        case PropertyKeys.SaveUnwind:
            let sourceViewController = segue.source as! NewToDoViewController
            if let toDo = sourceViewController.toDo {
                if let selectedIndexPath = tableView.indexPathForSelectedRow {
                    switch self.optionDaySegmentedControl.selectedSegmentIndex {
                    case 0:
                        yesterdayToDos[selectedIndexPath.row] = toDo
                    case 1:
                        todayToDos[selectedIndexPath.row] = toDo
                    case 2:
                        tomorrowToDos[selectedIndexPath.row] = toDo
                    case 3:
                        otherTimeToDos[selectedIndexPath.row] = toDo
                    default:
                        preconditionFailure("unrecognize case")
                    }
                    tableView.reloadRows(at: [selectedIndexPath], with: .none)
                    tableView.deselectRow(at: selectedIndexPath, animated: true)
                    self.saveCurrentToDos()
                } else {
                    var newIndexPath: IndexPath
                    let optionDay = toDo.categorizedDay()
                    switch optionDay {
                    case .yesterday:
                        newIndexPath = IndexPath(row: yesterdayToDos.count, section: 0)
                        yesterdayToDos.append(toDo)
                    case .today:
                        newIndexPath = IndexPath(row: todayToDos.count, section: 0)
                        todayToDos.append(toDo)
                    case .tomorrow:
                        newIndexPath = IndexPath(row: tomorrowToDos.count, section: 0)
                        tomorrowToDos.append(toDo)
                    case .otherTime:
                        newIndexPath = IndexPath(row: otherTimeToDos.count, section: 0)
                        otherTimeToDos.append(toDo)
                    }
                    if toDo.categorizedDay() == .yesterday && optionDaySegmentedControl.selectedSegmentIndex == 0 {
                        tableView.insertRows(at: [newIndexPath], with: .automatic)
                    } else if toDo.categorizedDay() == .today && optionDaySegmentedControl.selectedSegmentIndex == 1 {
                        tableView.insertRows(at: [newIndexPath], with: .automatic)
                    } else if toDo.categorizedDay() == .tomorrow && optionDaySegmentedControl.selectedSegmentIndex == 2 {
                        tableView.insertRows(at: [newIndexPath], with: .automatic)
                    } else if toDo.categorizedDay() == .otherTime && optionDaySegmentedControl.selectedSegmentIndex == 3 {
                        tableView.insertRows(at: [newIndexPath], with: .automatic)
                    }
                }
                self.saveCurrentToDos()
            }
        case PropertyKeys.CancelUnwind:
            if let selectedIndexPath = tableView.indexPathForSelectedRow {
                tableView.deselectRow(at: selectedIndexPath, animated: true)
            }
        default:
            preconditionFailure("No segue identified")
        }
    }
    
    override func prepare(for segue: UIStoryboardSegue, sender: Any?) {
        if segue.identifier == PropertyKeys.ShowDetailsToDo {
            let toDoViewController = segue.destination as! NewToDoViewController
            let selectedIndexPath = tableView.indexPathForSelectedRow!
            var selectedToDo: ToDo
            switch optionDaySegmentedControl.selectedSegmentIndex {
            case 0:
                selectedToDo = yesterdayToDos[selectedIndexPath.row]
            case 1:
                selectedToDo = todayToDos[selectedIndexPath.row]
            case 2:
                selectedToDo = tomorrowToDos[selectedIndexPath.row]
            case 3:
                selectedToDo = otherTimeToDos[selectedIndexPath.row]
            default:
                preconditionFailure("unricognized case")
            }
            toDoViewController.toDo = selectedToDo
        }
    }
    
    // MARK: Conform the Protocol
    func checkmarkTapped(sender: ToDoTableViewCell) {
        if let indexPath = tableView.indexPath(for: sender) {
            var toDo: ToDo
            switch optionDaySegmentedControl.selectedSegmentIndex {
            case 0:
                toDo = yesterdayToDos[indexPath.row]
                toDo.isComplete = !toDo.isComplete
                yesterdayToDos[indexPath.row] = toDo
            case 1:
                toDo = todayToDos[indexPath.row]
                toDo.isComplete = !toDo.isComplete
                todayToDos[indexPath.row] = toDo
            case 2:
                toDo = tomorrowToDos[indexPath.row]
                toDo.isComplete = !toDo.isComplete
                tomorrowToDos[indexPath.row] = toDo
            case 3:
                toDo = otherTimeToDos[indexPath.row]
                toDo.isComplete = !toDo.isComplete
                otherTimeToDos[indexPath.row] = toDo
            default:
                preconditionFailure("unricognize case")
            }
            tableView.reloadRows(at: [indexPath], with: .automatic)
            self.saveCurrentToDos()
        }
    }
    
    func tableView(_ tableView: UITableView, didSelectRowAt indexPath: IndexPath) {
        
        performSegue(withIdentifier: PropertyKeys.ShowDetailsToDo, sender: self)
        
    }

    @IBAction func editBarButtonItemTapped(_ sender: UIBarButtonItem) {
        
        if !tableView.isEditing {
            tableView.setEditing(true, animated: true)
            sender.title = "Done"
        } else {
            tableView.setEditing(false, animated: true)
            sender.title = "Edit"
        }
        
    }
    
    @IBAction func toDosForSelectedDay(_ sender: UISegmentedControl) {
        
        var updatedToDos = [ToDo]()
        ToDoController.shared.prototypeMark1LoadToDos { (LoadToDoResult) in
            switch LoadToDoResult {
            case .success(let obteinedToDos):
                updatedToDos = obteinedToDos
            case .failureInvalidData(let message):
                print("\(message)")
                self.currentToDos = ToDoController.loadSampleToDos()
            case .failureInvalidURL(let urlError):
                print("\(urlError.localizedDescription)")
                self.currentToDos = ToDoController.loadSampleToDos()
            }
        }
        switch sender.selectedSegmentIndex {
        case 0:
            self.yesterdayToDos = ToDoController.shared.toDosFor(optionDay: .yesterday, toDos: updatedToDos)
        case 1:
            self.todayToDos = ToDoController.shared.toDosFor(optionDay: .today, toDos: updatedToDos)
        case 2:
            self.tomorrowToDos = ToDoController.shared.toDosFor(optionDay: .tomorrow, toDos: updatedToDos)
        case 3:
            self.otherTimeToDos = ToDoController.shared.toDosFor(optionDay: .otherTime, toDos: updatedToDos)
        default:
            preconditionFailure("There is no other option")
        }
        tableView.reloadData()
        
    }
    
}
```

![Screen Recording 2021-04-09 at 16 50 31 2021-04-09 16_55_22](https://user-images.githubusercontent.com/24994818/114244737-a802f200-9954-11eb-81e0-a0468d04588d.gif)

# 41. [Improve `unwindToToDoList(sender:)` after you save a new ToDo object](https://github.com/c4arl0s/ChronoList#chronolist---content)

This is the Ugly piece of code:

```swift
@IBAction func unwindToToDoList(segue: UIStoryboardSegue) {
    
    switch segue.identifier {
    case PropertyKeys.SaveUnwind:
        let sourceViewController = segue.source as! NewToDoViewController
        if let toDo = sourceViewController.toDo {
            if let selectedIndexPath = tableView.indexPathForSelectedRow {
                switch self.optionDaySegmentedControl.selectedSegmentIndex {
                case 0:
                    yesterdayToDos[selectedIndexPath.row] = toDo
                case 1:
                    todayToDos[selectedIndexPath.row] = toDo
                case 2:
                    tomorrowToDos[selectedIndexPath.row] = toDo
                case 3:
                    otherTimeToDos[selectedIndexPath.row] = toDo
                default:
                    preconditionFailure("unrecognize case")
                }
                tableView.reloadRows(at: [selectedIndexPath], with: .none)
                tableView.deselectRow(at: selectedIndexPath, animated: true)
                self.saveCurrentToDos()
            } else {
                var newIndexPath: IndexPath
                let optionDay = toDo.categorizedDay()
                switch optionDay {
                case .yesterday:
                    newIndexPath = IndexPath(row: yesterdayToDos.count, section: 0)
                    yesterdayToDos.append(toDo)
                case .today:
                    newIndexPath = IndexPath(row: todayToDos.count, section: 0)
                    todayToDos.append(toDo)
                case .tomorrow:
                    newIndexPath = IndexPath(row: tomorrowToDos.count, section: 0)
                    tomorrowToDos.append(toDo)
                case .otherTime:
                    newIndexPath = IndexPath(row: otherTimeToDos.count, section: 0)
                    otherTimeToDos.append(toDo)
                }
                if toDo.categorizedDay() == .yesterday && optionDaySegmentedControl.selectedSegmentIndex == 0 {
                    tableView.insertRows(at: [newIndexPath], with: .automatic)
                } else if toDo.categorizedDay() == .today && optionDaySegmentedControl.selectedSegmentIndex == 1 {
                    tableView.insertRows(at: [newIndexPath], with: .automatic)
                } else if toDo.categorizedDay() == .tomorrow && optionDaySegmentedControl.selectedSegmentIndex == 2 {
                    tableView.insertRows(at: [newIndexPath], with: .automatic)
                } else if toDo.categorizedDay() == .otherTime && optionDaySegmentedControl.selectedSegmentIndex == 3 {
                    tableView.insertRows(at: [newIndexPath], with: .automatic)
                }
            }
            self.saveCurrentToDos()
        }
    case PropertyKeys.CancelUnwind:
        if let selectedIndexPath = tableView.indexPathForSelectedRow {
            tableView.deselectRow(at: selectedIndexPath, animated: true)
        }
    default:
        preconditionFailure("No segue identified")
    }

}
```

This is the improvement:

```swift
@IBAction func unwindToToDoList(segue: UIStoryboardSegue) {
    
    switch segue.identifier {
    case PropertyKeys.SaveUnwind:
        let sourceViewController = segue.source as! NewToDoViewController
        if let toDo = sourceViewController.toDo {
            if let selectedIndexPath = tableView.indexPathForSelectedRow {
                switch self.optionDaySegmentedControl.selectedSegmentIndex {
                case 0:
                    yesterdayToDos[selectedIndexPath.row] = toDo
                case 1:
                    todayToDos[selectedIndexPath.row] = toDo
                case 2:
                    tomorrowToDos[selectedIndexPath.row] = toDo
                case 3:
                    otherTimeToDos[selectedIndexPath.row] = toDo
                default:
                    preconditionFailure("unrecognize case")
                }
                tableView.reloadRows(at: [selectedIndexPath], with: .none)
                tableView.deselectRow(at: selectedIndexPath, animated: true)
                self.saveCurrentToDos()
            } else {
                var newIndexPath: IndexPath
                let optionDay = toDo.categorizedDay()
                switch optionDay {
                case .yesterday:
                    newIndexPath = IndexPath(row: yesterdayToDos.count, section: 0)
                    yesterdayToDos.append(toDo)
                    if optionDaySegmentedControl.selectedSegmentIndex == 0 {
                        tableView.insertRows(at: [newIndexPath], with: .automatic)
                    }
                case .today:
                    newIndexPath = IndexPath(row: todayToDos.count, section: 0)
                    todayToDos.append(toDo)
                    if optionDaySegmentedControl.selectedSegmentIndex == 1 {
                        tableView.insertRows(at: [newIndexPath], with: .automatic)
                    }
                case .tomorrow:
                    newIndexPath = IndexPath(row: tomorrowToDos.count, section: 0)
                    tomorrowToDos.append(toDo)
                    if optionDaySegmentedControl.selectedSegmentIndex == 2  {
                        tableView.insertRows(at: [newIndexPath], with: .automatic)
                    }
                case .otherTime:
                    newIndexPath = IndexPath(row: otherTimeToDos.count, section: 0)
                    otherTimeToDos.append(toDo)
                    if optionDaySegmentedControl.selectedSegmentIndex == 3 {
                        tableView.insertRows(at: [newIndexPath], with: .automatic)
                    }
                }
            }
            self.saveCurrentToDos()
        }
    case PropertyKeys.CancelUnwind:
        if let selectedIndexPath = tableView.indexPathForSelectedRow {
            tableView.deselectRow(at: selectedIndexPath, animated: true)
        }
    default:
        preconditionFailure("No segue identified")
    }
    
}
```

As you can see, once you get the new toDo object and append it to the correct array, you insert the row into the correct IndexPath if is selected the corresponding segment.

# 42. [Move check box button to the right](https://github.com/c4arl0s/ChronoList#chronolist---content)

1. Remove startButton (it is redundant to have it) from ToDoTableViewCell.xib file.
2. remove constrains of each subview, (textfield and buttons).
3. Construct the new constraints for checkBox button from ToDoTableViewCell.xib file and remove IBOutlet button from ToDoTableViewCell.swift file

![Screen Shot 2021-04-14 at 23 08 03](https://user-images.githubusercontent.com/24994818/114812780-51dbe780-9d76-11eb-99e8-77d2334044a8.png)

![Screen Shot 2021-04-14 at 22 46 09](https://user-images.githubusercontent.com/24994818/114811170-3d4a2000-9d73-11eb-83ec-3f8b08294e8c.png)

# 43. [Once you tap addButton show keyboard right away](https://github.com/c4arl0s/ChronoList#chronolist---content)

1. Find `viewDidLoad()`'s NewToDoViewController method, if you are going to create a new ToDo, make titleTextField becone first responder.

```swift
override func viewDidLoad() {
    
    super.viewDidLoad()
    if let toDo = toDo { // if you inject a ToDo
        navigationItem.title = "To-Do"
        titleTextField.text = toDo.title
        isCompletButton.isSelected = toDo.isComplete
        dueDatePickerView.date = toDo.dueDate
        notesTextView.text = toDo.note
    } else { // if you don't inject a ToDo
        dueDatePickerView.date = Date().addingTimeInterval(24*60*60)
        dueDateLabel.textColor = .gray
        titleTextField.becomeFirstResponder()
    }
    updateDueDateLabel(date: dueDatePickerView.date)
    updateSaveButtonState()
    
}
```

![RPReplay_Final1618460691 2021-04-14 23_27_36](https://user-images.githubusercontent.com/24994818/114814082-0ecf4380-9d79-11eb-87e0-c033a0554be3.gif)

# 44. [Move Segmented Control outside of toolbar](https://github.com/c4arl0s/ChronoList#chronolist---content) 

According to Human Interface Guidelines, avoid using a segmented control in a toolbar. I will move the segmented control outside.

![Screen Shot 2021-04-20 at 16 11 19](https://user-images.githubusercontent.com/24994818/115464711-1bc5ba00-a1f3-11eb-9ff2-a3c753c083a3.png)

# 45. [In New To Do Viewcontroller, move check box to the right.](https://github.com/c4arl0s/ChronoList#chronolist---content)

![Screen Shot 2021-04-20 at 16 34 19](https://user-images.githubusercontent.com/24994818/115466870-482f0580-a1f6-11eb-9c9d-d7846122edad.png)

![Screen Recording 2021-04-20 at 16 23 04 2021-04-20 16_31_00](https://user-images.githubusercontent.com/24994818/115466901-53823100-a1f6-11eb-8cd7-21b76c509410.gif)

